# Session Overview: Milestone 1 Step 2 - Leagues API

- Date: Monday, 16 February 2026
- Time: 20:14:46 +00:00
- Session Timestamp: 2026-02-16_20-14-46

## Scope
Implemented the Leagues endpoints from `docs/05-API-Spec-v1.md` in sequence after Rulesets:

- `POST /api/v1/orgs/:orgId/leagues`
- `GET /api/v1/orgs/:orgId/leagues`
- `GET /api/v1/orgs/:orgId/leagues/:leagueId`
- `PATCH /api/v1/orgs/:orgId/leagues/:leagueId`

## Files Added
- `apps/api/src/modules/leagues/leagues.module.ts`
- `apps/api/src/modules/leagues/leagues.controller.ts`
- `apps/api/src/modules/leagues/leagues.service.ts`
- `apps/api/src/modules/leagues/dto/create-league.dto.ts`
- `apps/api/src/modules/leagues/dto/update-league.dto.ts`
- `apps/api/test/leagues.e2e-spec.ts`

## Files Updated
- `apps/api/src/modules/app/app.module.ts`

## Implementation Notes
- All service methods are org-scoped and take `orgId` first.
- Tenant isolation is enforced by querying leagues/rulesets with `organisationId` filters.
- Added ruleset ownership and sport-alignment checks:
  - league creation requires ruleset to belong to same org
  - league sport must match ruleset sport
  - update enforces same invariant across patched fields
- Added a concise inline note in service for this invariant.

## Test Coverage
Added e2e test for:
- league create/list/get/update flow
- tenant isolation (`403` for non-member access)

File:
- `apps/api/test/leagues.e2e-spec.ts`

## Verification
Command run:
- `npm --workspace apps/api run test:e2e`

Result:
- 6 suites passed (`auth`, `orgs`, `memberships`, `fixtures`, `rulesets`, `leagues`)
- 6 tests passed

## Outcome
Milestone 1 now includes both Rulesets and Leagues APIs in the documented order, with e2e validation and tenant-safe behavior.
